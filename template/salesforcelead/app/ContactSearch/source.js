"use strict";//////	This is standard jQuery idiom; it gets called after the DOM tree has been created//$(document).ready(CDF_Initialize);function CDF_Ready(){      //    //  Declare whether or no this tasklet would benefit from data caching    //    FW.allowDataCaching = true;        var requestedQueries = new Array();    requestedQueries.push(new DeclareDataValueObject("DM.footerInitialized","Boolean"));    requestedQueries.push(new DeclareDataValueObject("DM.account","Account"));    requestedQueries.push(new DeclareDataValueObject("DM.contact","Contact"));    requestedQueries.push(new DeclareDataValueObject("DM.contactRole","String"));    requestedQueries.push(new DeclareDataValueObject("DM.addressLine1","String"));    requestedQueries.push(new DeclareDataValueObject("DM.addressLine2","String"));    requestedQueries.push(new DeclareDataValueObject("DM.contactAccountName","String"));    requestedQueries.push(new VirtualQueryRequestObject("ec-ContactLookup-Type",            [                 {targetType:"User",targetVariableName:"DM.myUser",targetIsSingleObject:true},                 //{targetType:"Opportunity",targetVariableName:"DM.allOpportunities",targetHashName:"DM.opportunityHash"},                 {targetType:"Account",targetVariableName:"DM.allAccounts",targetHashName:"DM.accountHash"},                 {targetType:"Contact",targetVariableName:"DM.allContacts",targetHashName:"DM.contactHash"}            ]            ));            //    //  Initialize the Framework; this will activate the Element-to-Data bindings and run the requested    //  queries (for data and metadata). This is data we need before the first page can be displayed.    //    FW.submitToServer(onRequestDataReady, requestedQueries);            //    // Declare an event handler to fire before the #AccountsAndOpportunities page is about to be shown.    //    $('#Loading').bind('pagebeforeshow', function(event)        {            MMCW.setHeaderTitle("Loading...");        });		//	// Declare an event handler to fire before the #AccountsAndOpportunities page is about to be shown.	//    $('#ContactList').bind('pagebeforeshow', function(event)        {            MMCW.setHeaderTitle("Search for Contact");            MMCW.setBack(null);        }    );    $('#ContactOnlyPage').bind('pagebeforeshow', function(event)            {                MMCW.setHeaderTitle("Search Results");                MMCW.setBack("#ContactList");            }        );        //    // Declare an event handler to fire before the #ContactDetail page is about to be shown.    //         $('#ContactDetail').bind('pagebeforeshow', function(event)        {            MMCW.setHeaderTitle(DM.contact.Name);            MMCW.setBack('#ContactOnlyPage');         }    );        //    // Declare an event handler to fire before the #SelectRelated page is about to be shown.    //            $('#SelectRelated').bind('pagebeforeshow', function(event)        {            MMCW.setHeaderTitle("Accounts");            MMCW.setRightButton(null,null);            MMCW.setBack('#NewContact');                        $("#searchInput").val("");            for (var i=0; i<DM.allAccounts.length; i++)            {                var id = "#acc-rc-" + i;                $(id).closest(".ui-radio").show();            }                }    );}function createNewContact(){    var contact = new Object();        contact.AccountId = null;        contact.FirstName = "";    contact.LastName = "";    contact.Name = "";    contact.Title = "";    contact.MailingStreet = "";    contact.MailingCity = "";    contact.MailingState = "";    contact.MailingPostalCode = "";        contact.Phone = "";    contact.MobilePhone = "";    contact.Fax = "";    contact.Email = "";        DM.set("DM.contact",contact);        if (DM.specificAccountSelected)    {        DM.set("DM.contact.AccountId",DM.specificAccountSelectedId);        DM.set("DM.contactAccountName", DM.specificAccountSelectedName);    }    else    {        DM.set("DM.contactAccountName","Select an Account");    }        FW.changePage("#NewContact");}function selectContact(contactExternalId){    var contact = DM.contactHash[contactExternalId];        if (contact)    {        var account = DM.accountHash[contact.AccountId];            DM.set("DM.contact",contact);        DM.set("DM.account", account);        var role;                if (contact.Title && (contact.Title.length > 0) && account)        {            role = contact.Title + " at " + account.Name;         }        else if (account)        {            role = account.Name;        }        else        {            role = "Unknown";        }                 $("#roleUL").empty();        $("#roleUL").append("<li>" + role + "</li>");        FW.refreshListview("#roleUL");                var anybodyVisible = false;          $("#phoneAndEmail").empty();                if (contact.MobilePhone && (contact.MobilePhone.length > 0))        {            anybodyVisible = true;            $("#phoneAndEmail").append('<li><a id="liMobile" href="tel:' + contact.MobilePhone + '">' +                     '<span  style="text-decoration:none; color:#0000ff; border-bottom:1px solid;" >' + contact.MobilePhone +  '</span>' +                     '<span class="ui-li-count">Mobile</span></a></li>');        }                if (contact.Phone && (contact.Phone.length > 0))        {            anybodyVisible = true;            $("#phoneAndEmail").append('<li><a id="liWork" href="tel:' + contact.Phone + '">' +                                         '<span  style="text-decoration:none; color:#0000ff; border-bottom:1px solid;" >' + contact.Phone +  '</span>' +                                          '<span class="ui-li-count">Office</span></a></li>');        }        if (contact.Fax && (contact.Fax.length > 0))        {            anybodyVisible = true;            $("#phoneAndEmail").append('<li><a id="liFax" href="tel:' + contact.Fax + '" >' +                                         '<span  style="text-decoration:none; color:#0000ff; border-bottom:1px solid;" >' + contact.Fax +  '</span>' +                                           '<span class="ui-li-count">Fax</span></a></li>');        }        if (contact.Email && (contact.Email.length > 0))        {            anybodyVisible = true;            //            //  "mailto" isn't quite working for iPhone yet            //            $("#phoneAndEmail").append('<li><a id="liEmail" href="mailto:' + contact.Email + '" >' +                      '<span  style="text-decoration:none; color:#0000ff; border-bottom:1px solid;" >' + contact.Email +  '</span>' +                  '<span class="ui-li-count">Email</span></a></li>');        }                                            if (anybodyVisible)        {            $("#phoneAndEmail").show();        }        else        {            $("#phoneAndEmail").hide();        }                FW.refreshListview("#phoneAndEmail");         var line1 = "";        var line2 = "";                if (contact.MailingStreet)        {            line1 = contact.MailingStreet;        }                if (contact.MailingCity && (contact.MailingCity.length > 0))        {            line2 = contact.MailingCity;                        if (contact.MailingState && (contact.MailingState.length > 0))            {                line2 += ", " + contact.MailingState;            }                        if (contact.MailingPostalCode && (contact.MailingPostalCode.length > 0))            {                line2 += " " + contact.MailingPostalCode;            }                       if (contact.MailingCountry && (contact.MailingCountry.length > 0))            {                line2 += " " + contact.MailingCountry;            }                   }                DM.set("DM.addressLine1", line1);        DM.set("DM.addressLine2", line2);                FW.changePage("#ContactDetail");    }}////	This gets called when the MetaData and Query requests have completed; we have all our data//	and we are ready to start.//function onRequestDataReady(){	DM.footerInitialized = false;	if (DM.myUser)    {        DM.myExternalId = DM.myUser.externalId;    }    FW.changePage("#ContactList");}function regenerateMainList(){    $("#mainList").empty();    if ($("#setSort").val() == "companyAndContacts")    {        for (var i=0; i<DM.allAccounts.length; i++)        {            var account = DM.allAccounts[i];                        if (account.contacts)            {                $("#mainList").append(   '<li data-role="list-divider" >' +                                             account.Name +                                         '</li>');                                for (var j=0; j<account.contacts.length; j++)                {                    var contact = account.contacts[j];                                         $("#mainList").append(  '<li data-theme="c">' +                                                '<a href="javascript:selectContact(\'' + contact.externalId + '\')">' +                                                     contact.Name +                                                '</a>' +                                            '</li>');                }            }        }     }     else if ($("#setSort").val() == "company")    {        for (var i=0; i<DM.allAccounts.length; i++)        {            var account = DM.allAccounts[i];                        if (account.contacts)            {                $("#mainList").append(  '<li data-theme="c">' +                        '<a href="javascript:selectCompany(\'' + account.externalId + '\')">' +                         account.Name +                        '</a>' +                    '</li>');            }        }     }               else if ($("#setSort").val() == "alpha")    {        var lastStart = null;                for (var i=0; i<DM.allContacts.length; i++)        {            var contact = DM.allContacts[i];                         var name = contact.Name;            var nameText = null;                        nameText = name;                        if (contact.AccountId)            {                var account = DM.accountHash[contact.AccountId];                                if (account)                {                    if (nameText.length > 0)                    {                        nameText += " ";                    }                    nameText += "(" + account.Name + ")";                }            }                        var firstChar;                        if (name.length == 0)            {                firstChar = "NO-NAME";            }            else            {                firstChar = name.substr(0,1).toLowerCase();            }                                               if (firstChar != lastStart)            {                lastStart = firstChar;                $("#mainList").append(   '<li data-role="list-divider" >' +                        firstChar.toUpperCase() +                    '</li>');                            }            $("#mainList").append(  '<li  data-theme="c">' +                                        '<a  href="javascript:selectContact(\'' + contact.externalId + '\')">' +                                         nameText +                                        '</a>' +                                    '</li>');        }       }        FW.refreshListview("#mainList");    $("#mainList").show();        FW.fixFooter();    }function searchForContact(){    var obj = new Object();    obj.op = "SELECT";    obj.targetType = "Contact";    obj.where = new Object();    obj.where.Name = DM.searchQuery;    obj.options = new Object();    obj.options.noCache = true;    FW.submitToServer(function(requestArray){        showSearchResults();    },[new QueryRequestObject(obj, "DM.allSearchResults")]);}function showSearchResults(){    if (DM.allSearchResults && DM.allSearchResults.length > 0)    {        $("#search").val('');        $("#contactOnlyList").empty();        for (var j=0; j<DM.allSearchResults.length; j++)        {            var contact = DM.allSearchResults[j];            if (DM.contactHash[contact.externalId])            {                $("#contactOnlyList").append(  '<li data-theme="c">' +                    '<a href="javascript:selectContact(\'' + contact.externalId + '\')">' +                    '<h3 class="ui-li-heading">' + contact.Name + '</h3>' +                    '<p class="ui-li-desc"><strong>'+ DM.accountHash[contact.AccountId].Name +                    '</strong></p>' +                    '</a>' +                    '</li>');            }        }        FW.refreshListview("#contactOnlyList");        FW.changePage("#ContactOnlyPage");    }    else    {        FW.alert("There were no results found for: " + DM.searchQuery + ".");    }}